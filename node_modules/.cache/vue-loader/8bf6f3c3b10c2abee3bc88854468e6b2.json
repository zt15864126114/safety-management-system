{"remainingRequest":"D:\\safety-management-system\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\safety-management-system\\src\\views\\Analysis.vue?vue&type=style&index=0&id=688411d4&scoped=true&lang=css","dependencies":[{"path":"D:\\safety-management-system\\src\\views\\Analysis.vue","mtime":1735550417502},{"path":"D:\\safety-management-system\\node_modules\\css-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\safety-management-system\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":499162500000},{"path":"D:\\safety-management-system\\node_modules\\postcss-loader\\src\\index.js","mtime":499162500000},{"path":"D:\\safety-management-system\\node_modules\\cache-loader\\dist\\cjs.js","mtime":499162500000},{"path":"D:\\safety-management-system\\node_modules\\vue-loader\\lib\\index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:DQouYW5hbHlzaXMgew0KICBwYWRkaW5nOiAyMHB4Ow0KfQ0KDQouY2hhcnQtY29udGFpbmVyIHsNCiAgbWFyZ2luOiAyMHB4IDA7DQp9DQoNCi5hbmFseXNpcy1jb25jbHVzaW9uIHsNCiAgbWFyZ2luOiAyMHB4IDA7DQp9DQoNCi5kYXRhLXRhYmxlIHsNCiAgbWFyZ2luLXRvcDogMjBweDsNCn0NCg0KLnBhZ2luYXRpb24tY29udGFpbmVyIHsNCiAgbWFyZ2luLXRvcDogMjBweDsNCiAgdGV4dC1hbGlnbjogcmlnaHQ7DQp9DQoNCi5lbC1mb3JtLWl0ZW0gew0KICBtYXJnaW4tYm90dG9tOiAxOHB4Ow0KfQ0K"},{"version":3,"sources":["Analysis.vue"],"names":[],"mappings":";AAiVA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Analysis.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"analysis\">\r\n    <!-- 分析条件设置 -->\r\n    <el-card>\r\n      <div slot=\"header\">\r\n        <span>数据分析条件</span>\r\n        <el-button style=\"float: right\"\r\n                   type=\"primary\"\r\n                   size=\"small\"\r\n                   @click=\"saveAsTemplate\">\r\n          保存为模板\r\n        </el-button>\r\n      </div>\r\n\r\n      <el-form :model=\"analysisForm\" :rules=\"rules\" ref=\"analysisForm\" label-width=\"100px\">\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"8\">\r\n            <el-form-item label=\"分析类型\" prop=\"type\">\r\n              <el-select v-model=\"analysisForm.type\" placeholder=\"请选择分析类型\">\r\n                <el-option label=\"趋势分析\" value=\"trend\"></el-option>\r\n                <el-option label=\"对比分析\" value=\"compare\"></el-option>\r\n                <el-option label=\"相关性分析\" value=\"correlation\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"8\">\r\n            <el-form-item label=\"数据指标\" prop=\"metrics\">\r\n              <el-select v-model=\"analysisForm.metrics\"\r\n                         multiple\r\n                         placeholder=\"请选择数据指标\">\r\n                <el-option label=\"温度\" value=\"temperature\"></el-option>\r\n                <el-option label=\"压力\" value=\"pressure\"></el-option>\r\n                <el-option label=\"流量\" value=\"flow\"></el-option>\r\n                <el-option label=\"设备状态\" value=\"status\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"8\">\r\n            <el-form-item label=\"时间范围\" prop=\"dateRange\">\r\n              <el-date-picker\r\n                  v-model=\"analysisForm.dateRange\"\r\n                  type=\"daterange\"\r\n                  range-separator=\"至\"\r\n                  start-placeholder=\"开始日期\"\r\n                  end-placeholder=\"结束日期\">\r\n              </el-date-picker>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n\r\n        <el-row :gutter=\"20\">\r\n          <el-col :span=\"8\">\r\n            <el-form-item label=\"数据粒度\" prop=\"granularity\">\r\n              <el-select v-model=\"analysisForm.granularity\" placeholder=\"请选择数据粒度\">\r\n                <el-option label=\"分钟\" value=\"minute\"></el-option>\r\n                <el-option label=\"小时\" value=\"hour\"></el-option>\r\n                <el-option label=\"天\" value=\"day\"></el-option>\r\n                <el-option label=\"月\" value=\"month\"></el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"8\">\r\n            <el-form-item label=\"设备选择\" prop=\"devices\">\r\n              <el-select v-model=\"analysisForm.devices\"\r\n                         multiple\r\n                         placeholder=\"请选择设备\">\r\n                <el-option\r\n                    v-for=\"device in deviceList\"\r\n                    :key=\"device.id\"\r\n                    :label=\"device.name\"\r\n                    :value=\"device.id\">\r\n                </el-option>\r\n              </el-select>\r\n            </el-form-item>\r\n          </el-col>\r\n          <el-col :span=\"8\">\r\n            <el-form-item>\r\n              <el-button type=\"primary\" @click=\"startAnalysis\">开始分析</el-button>\r\n              <el-button @click=\"resetForm\">重置</el-button>\r\n            </el-form-item>\r\n          </el-col>\r\n        </el-row>\r\n      </el-form>\r\n    </el-card>\r\n\r\n    <!-- 分析结果展示 -->\r\n    <el-card style=\"margin-top: 20px;\" v-loading=\"loading\">\r\n      <div slot=\"header\">\r\n        <span>分析结果</span>\r\n        <el-button-group style=\"float: right\">\r\n          <el-button size=\"small\" @click=\"exportData\">导出数据</el-button>\r\n          <el-button size=\"small\" @click=\"exportImage\">导出图表</el-button>\r\n        </el-button-group>\r\n      </div>\r\n\r\n      <!-- 图表展示区域 -->\r\n      <div class=\"chart-container\">\r\n        <div id=\"mainChart\" style=\"height: 400px;\"></div>\r\n      </div>\r\n\r\n      <!-- 分析结论 -->\r\n      <div class=\"analysis-conclusion\" v-if=\"conclusion\">\r\n        <h3>分析结论</h3>\r\n        <el-alert\r\n            :title=\"conclusion.title\"\r\n            :type=\"conclusion.type\"\r\n            :description=\"conclusion.description\"\r\n            show-icon>\r\n        </el-alert>\r\n      </div>\r\n\r\n      <!-- 详细数据表格 -->\r\n      <div class=\"data-table\" v-if=\"tableData.length\">\r\n        <h3>详细数据</h3>\r\n        <el-table :data=\"tableData\" border style=\"width: 100%\">\r\n          <el-table-column\r\n              v-for=\"(col, index) in tableColumns\"\r\n              :key=\"index\"\r\n              :prop=\"col.prop\"\r\n              :label=\"col.label\"\r\n              :width=\"col.width\">\r\n          </el-table-column>\r\n        </el-table>\r\n        <div class=\"pagination-container\">\r\n          <el-pagination\r\n              @size-change=\"handleSizeChange\"\r\n              @current-change=\"handleCurrentChange\"\r\n              :current-page=\"currentPage\"\r\n              :page-sizes=\"[10, 20, 50, 100]\"\r\n              :page-size=\"pageSize\"\r\n              layout=\"total, sizes, prev, pager, next, jumper\"\r\n              :total=\"total\">\r\n          </el-pagination>\r\n        </div>\r\n      </div>\r\n    </el-card>\r\n\r\n    <!-- 保存模板对话框 -->\r\n    <el-dialog title=\"保存分析模板\" :visible.sync=\"templateDialogVisible\">\r\n      <el-form :model=\"templateForm\" :rules=\"templateRules\" ref=\"templateForm\">\r\n        <el-form-item label=\"模板名称\" prop=\"name\">\r\n          <el-input v-model=\"templateForm.name\" placeholder=\"请输入模板名称\"></el-input>\r\n        </el-form-item>\r\n        <el-form-item label=\"模板描述\" prop=\"description\">\r\n          <el-input type=\"textarea\"\r\n                    v-model=\"templateForm.description\"\r\n                    placeholder=\"请输入模板描述\">\r\n          </el-input>\r\n        </el-form-item>\r\n      </el-form>\r\n      <div slot=\"footer\">\r\n        <el-button @click=\"templateDialogVisible = false\">取消</el-button>\r\n        <el-button type=\"primary\" @click=\"saveTemplate\">保存</el-button>\r\n      </div>\r\n    </el-dialog>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\nimport * as echarts from 'echarts'\r\nimport { saveAs } from 'file-saver'\r\nimport * as XLSX from 'xlsx'\r\n\r\nexport default {\r\n  name: 'Analysis',\r\n  data() {\r\n    return {\r\n      // 分析表单\r\n      analysisForm: {\r\n        type: '',\r\n        metrics: [],\r\n        dateRange: [],\r\n        granularity: '',\r\n        devices: []\r\n      },\r\n      // 表单验证规则\r\n      rules: {\r\n        type: [{ required: true, message: '请选择分析类型', trigger: 'change' }],\r\n        metrics: [{ required: true, message: '请选择数据指标', trigger: 'change' }],\r\n        dateRange: [{ required: true, message: '请选择时间范围', trigger: 'change' }],\r\n        granularity: [{ required: true, message: '请选择数据粒度', trigger: 'change' }],\r\n        devices: [{ required: true, message: '请选择设备', trigger: 'change' }]\r\n      },\r\n      // 设备列表\r\n      deviceList: [],\r\n      // 加载状态\r\n      loading: false,\r\n      // 分析结论\r\n      conclusion: null,\r\n      // 表格数据\r\n      tableData: [],\r\n      tableColumns: [],\r\n      currentPage: 1,\r\n      pageSize: 10,\r\n      total: 0,\r\n      // 模板对话框\r\n      templateDialogVisible: false,\r\n      templateForm: {\r\n        name: '',\r\n        description: ''\r\n      },\r\n      templateRules: {\r\n        name: [{ required: true, message: '请输入模板名称', trigger: 'blur' }]\r\n      }\r\n    }\r\n  },\r\n  mounted() {\r\n    this.getDeviceList()\r\n  },\r\n  methods: {\r\n    // 获取设备列表\r\n    async getDeviceList() {\r\n      // 模拟API调用\r\n      this.deviceList = [\r\n        { id: 'DEV001', name: '反应釜A' },\r\n        { id: 'DEV002', name: '储罐B' }\r\n      ]\r\n    },\r\n\r\n    // 开始分析\r\n    startAnalysis() {\r\n      this.$refs.analysisForm.validate(valid => {\r\n        if (valid) {\r\n          this.loading = true\r\n          // 模拟分析过程\r\n          setTimeout(() => {\r\n            this.generateAnalysisResult()\r\n            this.loading = false\r\n          }, 2000)\r\n        }\r\n      })\r\n    },\r\n\r\n    // 生成分析结果\r\n    generateAnalysisResult() {\r\n      // 生成图表\r\n      this.initChart()\r\n\r\n      // 生成结论\r\n      this.conclusion = {\r\n        title: '分析发现异常趋势',\r\n        type: 'warning',\r\n        description: '在过去24小时内，设备温度呈现上升趋势，建议关注。'\r\n      }\r\n\r\n      // 生成表格数据\r\n      this.generateTableData()\r\n    },\r\n\r\n    // 初始化图表\r\n    initChart() {\r\n      const chart = echarts.init(document.getElementById('mainChart'))\r\n      const option = {\r\n        // 图表配置...\r\n      }\r\n      chart.setOption(option)\r\n    },\r\n\r\n    // 生成表格数据\r\n    generateTableData() {\r\n      // 生成表格列\r\n      this.tableColumns = [\r\n        { prop: 'time', label: '时间', width: '180' },\r\n        { prop: 'device', label: '设备', width: '120' },\r\n        { prop: 'value', label: '数值', width: '100' }\r\n      ]\r\n\r\n      // 生成表格数据\r\n      this.tableData = [\r\n        { time: '2024-01-20 10:00', device: '反应釜A', value: 65.2 },\r\n        { time: '2024-01-20 10:30', device: '反应釜A', value: 66.5 }\r\n      ]\r\n      this.total = this.tableData.length\r\n    },\r\n\r\n    // 导出数据\r\n    exportData() {\r\n      const wb = XLSX.utils.book_new()\r\n      const ws = XLSX.utils.json_to_sheet(this.tableData)\r\n      XLSX.utils.book_append_sheet(wb, ws, '分析数据')\r\n      const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' })\r\n      saveAs(new Blob([wbout], { type: 'application/octet-stream' }), '分析数据.xlsx')\r\n    },\r\n\r\n    // 导出图表\r\n    exportImage() {\r\n      const chart = echarts.getInstanceByDom(document.getElementById('mainChart'))\r\n      const url = chart.getDataURL()\r\n      saveAs(this.dataURLtoBlob(url), '分析图表.png')\r\n    },\r\n\r\n    // DataURL转Blob\r\n    dataURLtoBlob(dataurl) {\r\n      const arr = dataurl.split(',')\r\n      const mime = arr[0].match(/:(.*?);/)[1]\r\n      const bstr = atob(arr[1])\r\n      let n = bstr.length\r\n      const u8arr = new Uint8Array(n)\r\n      while (n--) {\r\n        u8arr[n] = bstr.charCodeAt(n)\r\n      }\r\n      return new Blob([u8arr], { type: mime })\r\n    },\r\n\r\n    // 保存为模板\r\n    saveAsTemplate() {\r\n      this.templateDialogVisible = true\r\n    },\r\n\r\n    // 保存模板\r\n    saveTemplate() {\r\n      this.$refs.templateForm.validate(valid => {\r\n        if (valid) {\r\n          // 保存模板逻辑\r\n          this.$message.success('模板保存成功')\r\n          this.templateDialogVisible = false\r\n        }\r\n      })\r\n    },\r\n\r\n    // 重置表单\r\n    resetForm() {\r\n      this.$refs.analysisForm.resetFields()\r\n    },\r\n\r\n    // 分页处理\r\n    handleSizeChange(val) {\r\n      this.pageSize = val\r\n    },\r\n    handleCurrentChange(val) {\r\n      this.currentPage = val\r\n    }\r\n  }\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.analysis {\r\n  padding: 20px;\r\n}\r\n\r\n.chart-container {\r\n  margin: 20px 0;\r\n}\r\n\r\n.analysis-conclusion {\r\n  margin: 20px 0;\r\n}\r\n\r\n.data-table {\r\n  margin-top: 20px;\r\n}\r\n\r\n.pagination-container {\r\n  margin-top: 20px;\r\n  text-align: right;\r\n}\r\n\r\n.el-form-item {\r\n  margin-bottom: 18px;\r\n}\r\n</style>"]}]}